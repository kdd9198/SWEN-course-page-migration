{{ $menuSection := default "docs" .Site.Params.MenuSection  }}
{{ $logoLink := default .Site.Home.RelPermalink .Site.Params.LogoLink}}

<aside class="menu">
    <div class="menu-content">
        <nav>
            <h2 class="brand">
                <div class="flex align-center">
                    {{- with .Site.Params.Logo -}}
                        <a href="{{ $logoLink }}">
                            <img src="{{ . | relURL }}" alt="Logo" />
                        </a>
                    {{- end -}}
                    <a href="{{ .Site.Home.RelPermalink }}">
                        <span>{{ .Site.Title }}</span>
                    </a>
                </div>
            </h2>
            {{ with .Site.GetPage $menuSection }}
                {{ template "section" (dict "Section" . "CurrentPage" $) }}
            {{ end }}
        </nav>
    </div>
</aside>

{{ define "section" }}{{/* (dict "Section" .Section "CurrentPage" .CurrentPage) */}}
    <ul>
        {{ range (where .Section.Pages "Params.menuHidden" "ne" true) }}
            {{ if .IsSection }}
                <li>
                    {{ template "page-link" (dict "Page" . "CurrentPage" $.CurrentPage) }}
                    {{ template "section" (dict "Section" . "CurrentPage" $.CurrentPage) }}
                </li>
            {{ else if and .IsPage .Content }}
                {{ template "page-link" (dict "Page" . "CurrentPage" $.CurrentPage) }}
            {{ end }}
        {{ end }}
    </ul>
{{ end }}

{{ define "page-link" }}{{/* (dict "Page" .Page "CurrentPage" .CurrentPage) */}}
    {{ $current := eq .CurrentPage .Page }}

    {{ if .Page.Content }}
        <a href="{{ .Page.RelPermalink }}" class="{{ if $current }}active{{ end }}">
            {{- .Page.Title -}}
        </a>
    {{ else }}
        <span>{{- .Page.Title -}}</span>
    {{ end }}
{{ end }}